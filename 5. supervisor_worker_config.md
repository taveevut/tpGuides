# Supervisor Config Example for Laravel Queue Worker

ตัวอย่างไฟล์ **Supervisor** ที่ใช้รัน Laravel Queue Worker (PHP 7.4)\
พร้อมใส่ comment (`;`) อธิบายการทำงานแต่ละบรรทัด

``` ini
[program:ascarrentp-worker]

; ========================
; Path และ Command
; ========================

; directory = โฟลเดอร์โปรเจกต์ Laravel
directory=/home/ascarrentp/domains/uat.ascarrentphuket.com/public_html/~laravel

; command = คำสั่ง PHP artisan queue:work
; - ชี้ PHP 7.4 ที่เครื่อง
; - ระบุคิวที่จะใช้ (--queue=notifications)
; - ตั้ง sleep/tries/timeout ตามต้องการ
command=/usr/local/php74/bin/php /home/ascarrentp/domains/uat.ascarrentphuket.com/public_html/~laravel/artisan queue:work --queue=notifications --sleep=1 --tries=5 --timeout=120

; ========================
; Process Settings
; ========================

; user = user ที่จะรัน worker
user=ascarrentp

; numprocs = จำนวน worker process ที่จะรันพร้อมกัน
numprocs=8

; process_name = รูปแบบชื่อ process แต่ละตัว
process_name=%(program_name)s_%(process_num)02d

; ========================
; Auto Start/Restart
; ========================

; autostart = true หมายถึงเริ่มอัตโนมัติเมื่อ Supervisor เริ่ม
autostart=true

; autorestart = true หมายถึงถ้า worker ตาย จะถูกสตาร์ทใหม่อัตโนมัติ
autorestart=true

; startsecs = เวลาที่รอให้ process ทำงานก่อนถือว่าสตาร์ทสำเร็จ
startsecs=5

; stopasgroup/killasgroup = หยุดทั้งกลุ่ม process พร้อมกัน
stopasgroup=true
killasgroup=true

; stopsignal = สัญญาณหยุด ใช้ QUIT เพื่อปิด queue worker อย่างปลอดภัย
stopsignal=QUIT

; stopwaitsecs = เวลารอสูงสุดก่อน kill จริง ๆ
stopwaitsecs=3600

; ========================
; Log Settings
; ========================

; stdout_logfile/stderr_logfile = แยกไฟล์ log ต่อโปรเซส
stdout_logfile=/home/ascarrentp/public_html/~laravel/worker-%(process_num)02d-stdout.log
stderr_logfile=/home/ascarrentp/public_html/~laravel/worker-%(process_num)02d-stderr.log

; จำกัดขนาด log ไฟล์
stdout_logfile_maxbytes=20MB
stderr_logfile_maxbytes=20MB

; เก็บ backup ไฟล์ log 5 ไฟล์ล่าสุด
stdout_logfile_backups=5
stderr_logfile_backups=5

; ========================
; Environment Variables (ถ้ามี)
; ========================

; environment=APP_ENV="production",APP_DEBUG="false",PATH="/usr/local/php74/bin:/usr/local/bin:/usr/bin:/bin"
```

------------------------------------------------------------------------

## วิธีใช้งาน

1.  บันทึกไฟล์นี้เป็น `.conf` ใน
    `/etc/supervisor/conf.d/ascarrentp-worker.conf`

2.  สั่งให้ Supervisor โหลด config ใหม่:

    ``` bash
    supervisorctl reread
    supervisorctl update
    ```

3.  เริ่ม worker ทั้งหมด:

    ``` bash
    supervisorctl start ascarrentp-worker:*
    ```

4.  ตรวจสอบสถานะ:

    ``` bash
    supervisorctl status
    ```

5.  ดู log ของ worker ตัวใดตัวหนึ่ง:

    ``` bash
    supervisorctl tail -f ascarrentp-worker:ascarrentp-worker_00 stderr
    ```
